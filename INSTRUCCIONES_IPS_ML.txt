================================================================================
    SISTEMA IPS CON MACHINE LEARNING - GU√çA DE INSTALACI√ìN Y USO
================================================================================

Este documento contiene las instrucciones paso a paso para configurar y usar
el Sistema de Prevenci√≥n de Intrusiones (IPS) con Machine Learning basado
en el dataset CICIDS2017.

================================================================================
REQUISITOS PREVIOS
================================================================================

1. Python 3.8 o superior instalado
2. Permisos de administrador (para capturar tr√°fico de red)
3. Dataset CICIDS2017 en la carpeta "datasets"
   - Archivo: Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv
   - (O cualquier otro dataset del CICIDS2017)

================================================================================
PASO 1: INSTALAR DEPENDENCIAS
================================================================================

Abre una terminal/CMD en la carpeta del proyecto y ejecuta:

    pip install -r requirements.txt

O instala manualmente:

    pip install scapy>=2.5.0
    pip install pandas>=2.0.0
    pip install numpy>=1.24.0
    pip install scikit-learn>=1.3.0
    pip install joblib>=1.3.0

NOTA: En Windows, si tienes problemas con Scapy, tambi√©n necesitar√°s:
    - Npcap o WinPcap instalado
    - Ejecutar Python como administrador

================================================================================
PASO 2: VERIFICAR EL DATASET
================================================================================

Aseg√∫rate de que el dataset est√© en la ubicaci√≥n correcta:

    datasets/Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv

Si tienes otros archivos del CICIDS2017, puedes modificar el script
entrenarModelo.py para usar otro dataset.

================================================================================
PASO 3: ENTRENAR EL MODELO DE MACHINE LEARNING
================================================================================

Este paso es OBLIGATORIO antes de usar el sistema de detecci√≥n.

Desde la carpeta ra√≠z del proyecto, ejecuta:

    python IPS/entrenarModelo.py

Este proceso:
- Cargar√° el dataset CICIDS2017
- Preprocesar√° los datos
- Entrenar√° un modelo Random Forest
- Guardar√° el modelo en: IPS/Modelos/modelo_ips.pkl
- Guardar√° el encoder en: IPS/Modelos/label_encoder.pkl

Tiempo estimado: 5-15 minutos (dependiendo del tama√±o del dataset)

Al finalizar ver√°s:
    ‚úÖ ENTRENAMIENTO COMPLETADO
    üíæ Modelo guardado en: IPS/Modelos/modelo_ips.pkl

IMPORTANTE: No podr√°s usar la detecci√≥n ML hasta completar este paso.

================================================================================
PASO 4: CONFIGURAR SERVIDOR WEB (Para la interfaz)
================================================================================

La interfaz web necesita un servidor HTTP para funcionar correctamente.

Opci√≥n A - Python (Recomendado):
    Desde la carpeta ra√≠z del proyecto:
    
    python -m http.server 8000
    
    Luego abre en el navegador:
    http://localhost:8000/panelAdmin.html

Opci√≥n B - Live Server (VS Code):
    - Instala la extensi√≥n "Live Server"
    - Click derecho en panelAdmin.html ‚Üí "Open with Live Server"

Opci√≥n C - Otro servidor web:
    - XAMPP, WAMP, o cualquier servidor web local
    - Coloca los archivos en la carpeta htdocs/www

================================================================================
PASO 5: CAPTURAR TR√ÅFICO CON DETECCI√ìN ML
================================================================================

IMPORTANTE: Ejecuta como ADMINISTRADOR (necesario para capturar tr√°fico de red)

Desde la carpeta ra√≠z del proyecto:

    python IPS/capturaRed.py

El sistema:
- Capturar√° paquetes de red en tiempo real
- Extraer√° caracter√≠sticas de flujos
- Usar√° el modelo ML para detectar intrusiones
- Guardar√° tr√°fico en: IPS/CapturaTrafico/trafico.json
- Guardar√° alertas en: IPS/CapturaTrafico/alertas.json

Ver√°s en la consola:
    ‚úÖ Sistema de detecci√≥n ML activado
    üì° Capturando tr√°fico...
    [HH:MM:SS] IP:Puerto -> IP:Puerto | Protocolo | Estado
    üö® ALERTA: Tipo_Ataque (XX.X%) | IP:Puerto -> IP:Puerto

Para detener la captura: Presiona Ctrl + C

NOTA: Por defecto captura 30 paquetes. Puedes modificar la l√≠nea:
    sniff(count=30, prn=procesarPaquete)
    
Para captura continua, cambia a:
    sniff(prn=procesarPaquete)

================================================================================
PASO 6: VISUALIZAR RESULTADOS EN LA INTERFAZ WEB
================================================================================

1. Abre el navegador y ve a: http://localhost:8000/panelAdmin.html
   (o la URL de tu servidor web)

2. Haz clic en "Tr√°fico de Red" en el men√∫ lateral

3. Ver√°s:
   - Tabla con el tr√°fico capturado en tiempo real
   - Contador de paquetes
   - Secci√≥n de alertas (si hay intrusiones detectadas)
   - Tr√°fico sospechoso resaltado en rojo

4. La p√°gina se actualiza autom√°ticamente cada 3 segundos

================================================================================
ESTRUCTURA DE ARCHIVOS
================================================================================

IPS ML/
‚îú‚îÄ‚îÄ datasets/
‚îÇ   ‚îî‚îÄ‚îÄ Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv
‚îú‚îÄ‚îÄ IPS/
‚îÇ   ‚îú‚îÄ‚îÄ capturaRed.py              # Captura tr√°fico + detecci√≥n ML
‚îÇ   ‚îú‚îÄ‚îÄ detectorML.py               # M√≥dulo de detecci√≥n ML
‚îÇ   ‚îú‚îÄ‚îÄ entrenarModelo.py           # Script de entrenamiento
‚îÇ   ‚îú‚îÄ‚îÄ extraccionCaracteristicas.py # Extracci√≥n de caracter√≠sticas
‚îÇ   ‚îú‚îÄ‚îÄ IPS.html                    # Interfaz de monitoreo
‚îÇ   ‚îú‚îÄ‚îÄ IPS.css                     # Estilos
‚îÇ   ‚îú‚îÄ‚îÄ Modelos/                    # (Se crea al entrenar)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modelo_ips.pkl
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ label_encoder.pkl
‚îÇ   ‚îî‚îÄ‚îÄ CapturaTrafico/             # (Se crea autom√°ticamente)
‚îÇ       ‚îú‚îÄ‚îÄ trafico.json            # Tr√°fico capturado
‚îÇ       ‚îî‚îÄ‚îÄ alertas.json            # Alertas de intrusiones
‚îú‚îÄ‚îÄ panelAdmin.html                 # Panel principal
‚îú‚îÄ‚îÄ panelAdmin.css                  # Estilos del panel
‚îú‚îÄ‚îÄ requirements.txt                 # Dependencias Python
‚îî‚îÄ‚îÄ INSTRUCCIONES_IPS_ML.txt        # Este archivo

================================================================================
SOLUCI√ìN DE PROBLEMAS
================================================================================

PROBLEMA: "Modelo no encontrado"
SOLUCI√ìN: Ejecuta primero el paso 3 (entrenarModelo.py)

PROBLEMA: "No se puede capturar tr√°fico"
SOLUCI√ìN: 
    - Ejecuta Python como administrador
    - Instala Npcap o WinPcap
    - Verifica permisos de red

PROBLEMA: "Error al cargar el modelo"
SOLUCI√ìN:
    - Verifica que existan los archivos en IPS/Modelos/
    - Re-entrena el modelo si es necesario

PROBLEMA: "No se muestran datos en la interfaz"
SOLUCI√ìN:
    - Verifica que el servidor web est√© ejecut√°ndose
    - Aseg√∫rate de que trafico.json existe
    - Revisa la consola del navegador (F12) para errores

PROBLEMA: "El modelo no detecta nada"
SOLUCI√ìN:
    - El modelo detecta patrones similares a los del dataset
    - Tr√°fico normal puede no generar alertas (es normal)
    - Verifica que el modelo se entren√≥ correctamente

PROBLEMA: "Error de importaci√≥n de m√≥dulos"
SOLUCI√ìN:
    - Verifica que todas las dependencias est√©n instaladas
    - Ejecuta: pip install -r requirements.txt

================================================================================
PERSONALIZACI√ìN
================================================================================

1. Cambiar n√∫mero de paquetes a capturar:
   En IPS/capturaRed.py, l√≠nea final:
   sniff(count=30, prn=procesarPaquete)  # Cambia 30 por el n√∫mero deseado

2. Cambiar intervalo de actualizaci√≥n de la interfaz:
   En IPS/IPS.html, busca:
   setInterval(() => { ... }, 3000)  # Cambia 3000 (3 seg) por otro valor

3. Usar otro dataset:
   En IPS/entrenarModelo.py, cambia:
   ruta_dataset = "datasets/TU_ARCHIVO.csv"

4. Ajustar sensibilidad del modelo:
   En IPS/capturaRed.py, puedes modificar el umbral de predicci√≥n
   o cambiar el n√∫mero m√≠nimo de paquetes antes de predecir

================================================================================
NOTAS IMPORTANTES
================================================================================

- El modelo se entrena con el dataset CICIDS2017, que contiene principalmente
  ataques web. Para otros tipos de ataques, necesitar√≠as entrenar con
  datasets apropiados.

- La extracci√≥n de caracter√≠sticas es una aproximaci√≥n. Algunas caracter√≠sticas
  del dataset original requieren an√°lisis m√°s profundo que se simplifican
  en tiempo real.

- El sistema funciona mejor con tr√°fico TCP/UDP. Otros protocolos pueden
  tener caracter√≠sticas limitadas.

- Las alertas se guardan en alertas.json (√∫ltimas 100)
- El tr√°fico se guarda en trafico.json (√∫ltimos 1000 paquetes)

================================================================================
SIGUIENTE PASOS (Opcional)
================================================================================

1. Entrenar con m√∫ltiples datasets del CICIDS2017 para mejor cobertura
2. Ajustar hiperpar√°metros del modelo Random Forest
3. Implementar otros algoritmos (SVM, Neural Networks, etc.)
4. Agregar m√°s caracter√≠sticas de an√°lisis
5. Implementar bloqueo autom√°tico de IPs sospechosas
6. Agregar dashboard con estad√≠sticas y gr√°ficos

================================================================================
CONTACTO Y SOPORTE
================================================================================

Si encuentras problemas:
1. Revisa la secci√≥n "Soluci√≥n de Problemas" arriba
2. Verifica que todos los pasos se completaron correctamente
3. Revisa los mensajes de error en la consola

================================================================================
¬°LISTO PARA USAR!
================================================================================

Sigue los pasos en orden:
1. ‚úÖ Instalar dependencias
2. ‚úÖ Verificar dataset
3. ‚úÖ Entrenar modelo
4. ‚úÖ Configurar servidor web
5. ‚úÖ Capturar tr√°fico
6. ‚úÖ Visualizar resultados

¬°Tu sistema IPS con Machine Learning est√° listo!

================================================================================

